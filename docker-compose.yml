version: "3"
services:
  ansible:
    build:
      context: .
      dockerfile: docker/ansible/Dockerfile
      target: ci
    volumes:
      - ./ansible:/ansible
    environment:
      ANSIBLE_USER:
      ANSIBLE_PASSWORD:

  ubuntu:
    build:
      context: docker/ubuntu
    shm_size: 1024m
    cap_add:
      - SYS_PTRACE
    environment:
      REPOSITORY_URL: http://git/ubuntu-config.git
      REPOSITORY_BRANCH: main

  git:
    build:
      context: .
      dockerfile: docker/git/Dockerfile
    volumes:
      - ./install.sh:/var/lib/git/ubuntu-config/install.sh:ro
      - ./ansible:/var/lib/git/ubuntu-config/ansible:ro
